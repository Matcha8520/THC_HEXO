<%- partial('_pre') %>
<% 
page.comments = false;
if (!page.robots) {
  page.robots = 'noindex,follow';
}
%>

<div id="l_main" class='<%- page.sidebar == false ? ' no_sidebar' : '' %>'>
  <!-- 标题区域：模仿分类页的样式 -->
  <div class='post-wrapper'>
    <article class="post article white-box reveal <%- theme.custom_css.body.effect.join(' ') %>">
      <h2><%- page.title %></h2>
      <%- page.content %>
    </article>
  </div>
  <!-- 杂志封面网格 -->
  <div class="magazine-grid">
    <% site.pages.sort("-date").each(function(post){ %>
      <% if (post.group && post.group == page.group && post.layout != 'list') { %>
        <div class="magazine-item">
          <a href="<%- post.path %>" class="magazine-link">
            <img src="<%- post.headimg || '/images/default-cover.jpg' %>" alt="<%- post.title %>" class="magazine-cover" />
            <div class="magazine-info">
              <h3 class="magazine-title"><%- post.title %></h3>
            </div>
          </a>
        </div>
      <% } %>
    <% }) %>

    <% site.posts.sort("-date").each(function(post){ %>
      <% if (post.group && post.group === page.group && post.layout !== 'list') { %>
        <div class="magazine-item">
          <a href="<%- url_for(post.path) %>" class="magazine-link"> <!-- 使用 url_for -->
            <% if (post.headimg) { %>
              <img src="<%- post.headimg %>" alt="<%- post.title %>" class="magazine-cover" />
            <% } else { %>
              <div class="magazine-cover placeholder" aria-label="无封面图"></div>
            <% } %>
            <div class="magazine-info">
              <h3 class="magazine-title"><%- post.title %></h3>
            </div>
          </a>
        </div>
      <% } %>
    <% }) %>
  </div>
</div>

<%- partial('_partial/side') %>